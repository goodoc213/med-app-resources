name: Auto Convert to PDF

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  convert:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Install LibreOffice
      run: |
        sudo apt-get update
        sudo apt-get install -y libreoffice
    
    - name: Find and convert files
      run: |
        echo "üîç Searching for files to convert..."
        
        find . -type f \( -iname "*.doc" -o -iname "*.docx" -o -iname "*.ppt" -o -iname "*.pptx" \) | while read file; do
          dir=$(dirname "$file")
          base=$(basename "$file" | sed 's/\.[^.]*$//')
          
          if [ -f "$dir/$base.pdf" ]; then
            echo "‚è≠Ô∏è  Skipping $file (PDF exists)"
            continue
          fi
          
          echo "üìÑ Converting: $file"
          soffice --headless --convert-to pdf --outdir "$dir" "$file"
          
          if [ $? -eq 0 ]; then
            echo "‚úÖ Converted: $file ‚Üí $base.pdf"
          else
            echo "‚ùå Failed to convert: $file"
          fi
        done
    
    - name: Commit converted PDFs
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        if [ -n "$(git status --porcelain)" ]; then
          git add .
          git commit -m "ü§ñ Auto-converted files to PDF"
          git push
          echo "‚úÖ Changes committed!"
        else
          echo "‚ÑπÔ∏è  No new files to convert"
        fi
